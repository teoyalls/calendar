(function(c,b,a){c.fn.Calendar=function(d){var e=c.extend({},{skin:"",calenWidth:"",calenHeight:"",defaultTime:"",type:1,beforeCreatFn:c.noop,afterCreatFn:c.noop,changeTimeFn:c.noop},d);function f(h){this.opts=h;this.w=this.opts.calenW;this.h=this.opts.calenH;this.$wrap=c('<div class="zr-calendar-wrap" style="display: none">');this.$mode=c('<div class="zr-calendar-mode">');this.$dayMode=c('<div class="zr-calendar-day-mode">');this.$yearMode=c('<div class="zr-calendar-year-mode">');this.$monthMode=c('<div class="zr-calendar-month-mode">');this.$timeMode=c('<div class="zr-calendar-time-mode">');this.$footer=c('<div class="zr-calender-footer">');this.initTime={};this.nowTime={};this.todayTime={};var j=new Date(),k=0,g=null;var i=function(l){return new Date(l).getDay()};this.getTodayTime();if(this.opts.defaultTime){j=d.defaultTime.split(" ");if(j.length>1){g=j[1].split(":");this.initTime.h=parseInt(g[0]-0)>9?parseInt(g[0]-0):"0"+parseInt(g[0]-0);this.initTime.m=parseInt(g[1]-0)>9?parseInt(g[1]-0):"0"+parseInt(g[1]-0);if(g[2]){this.initTime.s=parseInt(g[2]-0)>9?parseInt(g[2]-0):"0"+parseInt(g[2]-0)}else{this.initTime.s="00"}}else{this.initTime.h="00";this.initTime.m="00";this.initTime.s="00"}g=j[0].split("/");this.initTime.year=g[0]-0;this.initTime.month=g[1]-1;this.initTime.day=g[2]-0;this.initTime.week=i(this.opts.defaultTime)}else{this.initTime=JSON.parse(JSON.stringify(this.todayTime))}this.nowTime=JSON.parse(JSON.stringify(this.initTime));this.$mode.append(this.$dayMode).append(this.$yearMode).append(this.$monthMode).append(this.$timeMode);this.$footer.html('<button class="confirm-btn">确定</button><button class="today-btn">今天</button><button class="cancel-btn">取消</button>');this.$wrap.append(this.$mode).append(this.$footer);k=c("body").find('.zr-calendar-wrap[data-key="zr-calend"]').length+1000;this.$wrap.attr("data-key","zr-calend").attr("data-id",k);c("body").append(this.$wrap.css({top:this.opts.topW+this.opts.h,left:this.opts.leftW,width:this.w,height:this.h,zIndex:k}))}f.prototype.getTodayTime=function(){var h=this,g=new Date();h.todayTime.year=g.getFullYear();h.todayTime.month=g.getMonth();h.todayTime.day=g.getDate();h.todayTime.week=g.getDay();h.todayTime.h=g.getHours()>9?g.getHours():"0"+g.getHours();h.todayTime.m=g.getMinutes()>9?g.getMinutes():"0"+g.getMinutes();h.todayTime.s=g.getSeconds()>9?g.getSeconds():"0"+g.getSeconds()};f.prototype.creatDayTable=function(){var n=this,i=c('<div class="zr-calendar-header">'),m=c('<div class="zr-calendar-cont">'),k=c('<table class="zr-calendar-table">');function h(o){return new Date(o).getDay()}function l(o){return(o%4==0)&&(o%100!=0||o%400==0)?29:28}function g(){var w="",r="",v=["日","一","二","三","四","五","六"],q=[31,l(n.nowTime.year),31,30,31,30,31,31,30,31,30,31],o=0,p=h(n.nowTime.year+"/"+(n.nowTime.month+1)+"/"+"1");for(var s=0;s<7;s++){r+="<td>"+v[s]+"</td>"}w+="<tr>"+r+"</tr>";for(var u=0;u<6;u++){r="";for(var t=0;t<7;t++){o=u*7+t+1-p;if(o<=0){if(n.nowTime.month==0){r+='<td class="empty"><span class="txt">'+(31+o)+"</span></td>"}else{r+='<td class="empty"><span class="txt">'+(q[n.nowTime.month-1]+o)+"</span></td>"}}else{if(o>q[n.nowTime.month]){r+='<td class="empty"><span class="txt">'+(o-q[n.nowTime.month])+"</span></td>"}else{if(o==n.nowTime.day){r+='<td class="dayer cur"><span class="txt">'+o+"</span></td>"}else{r+='<td class="dayer"><span class="txt">'+o+"</span></td>"}}}}w+="<tr>"+r+"</tr>"}k.html(w)}function j(){var o=c('<button class="year-prev-btn">'),r=c('<button class="year-next-btn">'),p=c('<button class="month-prev-btn">'),s=c('<button class="month-next-btn">'),q=c('<div class="header-cont">');q.html('<span class="year-text">'+n.nowTime.year+"年</span>"+'<span class="month-text">'+(n.nowTime.month-0+1)+"月<span>");i.html("").append(o).append(p).append(q).append(s).append(r).show()}j();g();n.$yearMode.html("");n.$monthMode.html("");n.$dayMode.html("").append(i).append(m.append(k))};f.prototype.creatMonthTable=function(){var l=this,h=c('<div class="year-header">'),g=c('<ul class="month-mode-list">'),k='<button class="year-prev"></button><p class="t">'+l.nowTime.year+'年</p><button class="year-next"></button>';li="";for(var j=0;j<12;j++){if(j==l.nowTime.month){li+='<li class="cur"><span>'+(j+1)+"月</span></li>"}else{li+="<li><span>"+(j+1)+"月</span></li>"}}g.html(li);h.html(k);l.$yearMode.html("");l.$dayMode.html("");l.$monthMode.html("").append(h).append(g)};f.prototype.creatYearTable=function(m){var n=this;var m=parseInt(m),j=c('<div class="year-header">'),h=c('<ul class="year-mode-list">'),l='<button class="year-prev"></button><p class="t">'+(m-10)+"年~"+(m+9)+'年</p><button class="year-next"></button>',g="";for(var k=0;k<20;k++){if((m-10+k)==n.nowTime.year){g+='<li class="cur"><span>'+(m-10+k)+"</span></li>"}else{g+="<li><span>"+(m-10+k)+"</span></li>"}}h.html(g);j.html(l);n.$dayMode.html("");n.$monthMode.html("");n.$yearMode.html("").append(j).append(h)};f.prototype.creatTimeTable=function(){var p=this,n=c('<div class="zr-calendar-date-info">'),i=c('<div class="zr-calendar-time-wrap">'),l=p.nowTime.h,g=p.nowTime.m,k=p.nowTime.s,o='<div class="time-list hour-wrap">'+'<button class="hour-next">&nbsp;</button>'+'<p class="hour-t">'+l+"</p>"+'<button class="hour-prev">&nbsp;</button>'+"</div>"+'<div class="time-list minute-wrap">'+'<button class="minute-next">&nbsp;</button>'+'<p class="minute-t">'+g+"</p>"+'<button class="minute-prev">&nbsp;</button>'+"</div>"+'<div class="time-list sec-wrap">'+'<button class="sec-next">&nbsp;</button>'+'<p class="sec-t">'+k+"</p>"+'<button class="sec-prev">&nbsp;</button>'+"</div>",j='<p class="c-day-info">'+'<span class="t t-d">'+p.nowTime.day+"</span>"+'<span class="n">日</span>'+"</p>"+'<p class="c-year-info">'+'<span class="t t-y">'+p.nowTime.year+"</span>"+'<span class="n">年</span>'+'<span class="t t-m">'+(p.nowTime.month+1)+"</span>"+'<span class="n">月</span>'+"</p>";
n.html(j);i.html(o);p.$timeMode.html("").append(n).append(i)};f.prototype.creatTimeNumTable=function(s){var p=this,g=0,h=0,r="",k="",u=c('<div class="zr-calendar-time-num">'),q=c('<div class="zr-calendar-num-txt">'),t=c('<table class="time-num-table">');switch(s){case 0:g=24;h=parseInt(p.nowTime.h);q.text("选择小时");t.addClass("time-num-houer");break;case 1:g=60;h=parseInt(p.nowTime.m);q.text("选择分钟");t.addClass("time-num-minute");break;default:g=60;h=parseInt(p.nowTime.s);q.text("选择秒数");t.addClass("time-num-sec")}for(var l=0;l<Math.ceil(g/8);l++){r="<tr>";k="";for(var o=0;o<8;o++){num=l*8+o;num=num>9?num:"0"+num;if(num==h){k+='<td class="cur"><span> '+num+" </span></td>"}else{if(s!=0&&num>=60){k+="<td></td>"}else{k+="<td><span> "+num+" </span></td>"}}}r+=k+"</tr>";t.append(c(r))}u.append(q).append(t);p.$timeMode.html("").append(u)};f.prototype.toInit=function(j){var n=this,h={};h.y=n.nowTime.year;h.m=n.nowTime.month;h.d=n.nowTime.day;function m(){var o=null;n.$dayMode.off("click.a").on("click.a",".year-prev-btn",function(){n.nowTime.year--;n.creatDayTable();o=null;i()});n.$dayMode.off("click.b").on("click.b",".year-next-btn",function(){n.nowTime.year++;n.creatDayTable();o=null;i()});n.$dayMode.off("click.c").on("click.c",".month-prev-btn",function(){n.nowTime.month--;if(n.nowTime.month<0){n.nowTime.month=11;n.nowTime.year--}n.creatDayTable();o=null;i()});n.$dayMode.off("click.d").on("click.d",".month-next-btn",function(){n.nowTime.month++;if(n.nowTime.month>11){n.nowTime.month=0;n.nowTime.year++}n.creatDayTable();o=null;i()});n.$dayMode.off("click.e").on("click.e",".header-cont .year-text",function(){n.creatYearTable(n.nowTime.year);o=null});n.$dayMode.off("click.f").on("click.f",".header-cont .month-text",function(){n.creatMonthTable();o=null});n.$dayMode.off("click.g").on("click.g",".zr-calendar-table .dayer .txt",function(){var p=c(this).parent();if(!o){o=n.$dayMode.find(".zr-calendar-table .dayer.cur")}o.removeClass("cur");o=p;o.addClass("cur");n.nowTime.day=o.text();i()});n.$monthMode.off("click.h").on("click.h",".month-mode-list>li>span",function(){n.creatDayTable();o=null;i()})}function l(o){n.$yearMode.off("click.i").on("click.i",".year-header .year-prev",function(){o=o-20;n.creatYearTable(o)});n.$yearMode.off("click.j").on("click.j",".year-header .year-next",function(){o=o-0+20;n.creatYearTable(o)});n.$yearMode.off("click.k").on("click.k",".year-mode-list>li>span",function(){o=c(this).text();n.nowTime.year=o;n.creatMonthTable();i()})}function g(){var p=null;var o=null;n.$monthMode.off("click.l").on("click.l",".year-header .year-prev",function(){n.nowTime.year--;p=n.$monthMode.find(".year-header .t");p.text(n.nowTime.year+"年");i()});n.$monthMode.off("click.m").on("click.m",".year-header .year-next",function(){n.nowTime.year++;p=n.$monthMode.find(".year-header .t");p.text(n.nowTime.year+"年");i()});n.$monthMode.off("click.n").on("click.n",".year-header .t",function(){n.creatYearTable(n.nowTime.year);o=null});n.$monthMode.off("click.o").on("click.o",".month-mode-list>li>span",function(){var q=c(this).parent();if(!o){o=n.$monthMode.find(".month-mode-list li.cur")}o.removeClass("cur");o=q;o.addClass("cur");n.nowTime.month=parseInt(o.text())-1})}function k(){var p=n.$timeMode.find(".hour-wrap .hour-t"),q=n.$timeMode.find(".minute-wrap .minute-t"),o=n.$timeMode.find(".sec-wrap .sec-t");n.$timeMode.off("click.p").on("click.p",".hour-wrap .hour-prev",function(){n.nowTime.h--;if(n.nowTime.h<0){n.nowTime.h=23}n.nowTime.h=n.nowTime.h>9?n.nowTime.h:"0"+n.nowTime.h;p.text(n.nowTime.h)});n.$timeMode.off("click.q").on("click.q",".hour-wrap .hour-next",function(){n.nowTime.h=n.nowTime.h-0+1;if(n.nowTime.h>23){n.nowTime.h=0}n.nowTime.h=n.nowTime.h>9?n.nowTime.h:"0"+n.nowTime.h;p.text(n.nowTime.h)});n.$timeMode.off("click.r").on("click.r",".minute-wrap .minute-prev",function(){n.nowTime.m--;if(n.nowTime.m<0){n.nowTime.m=59}n.nowTime.m=n.nowTime.m>9?n.nowTime.m:"0"+n.nowTime.m;q.text(n.nowTime.m)});n.$timeMode.off("click.s").on("click.s",".minute-wrap .minute-next",function(){n.nowTime.m=n.nowTime.m-0+1;if(n.nowTime.m>59){n.nowTime.m=0}n.nowTime.m=n.nowTime.m>9?n.nowTime.m:"0"+n.nowTime.m;q.text(n.nowTime.m)});n.$timeMode.off("click.t").on("click.t",".sec-wrap .sec-prev",function(){n.nowTime.s--;if(n.nowTime.s<0){n.nowTime.s=59}n.nowTime.s=n.nowTime.s>9?n.nowTime.s:"0"+n.nowTime.s;o.text(n.nowTime.s)});n.$timeMode.off("click.u").on("click.u",".sec-wrap .sec-next",function(){n.nowTime.s=n.nowTime.s-0+1;if(n.nowTime.s>59){n.nowTime.s=0}n.nowTime.s=n.nowTime.s>9?n.nowTime.s:"0"+n.nowTime.s;o.text(n.nowTime.s)});n.$timeMode.off("click.v").on("click.v",".zr-calendar-time-wrap .hour-t",function(){n.creatTimeNumTable(0)});n.$timeMode.off("click.w").on("click.w",".zr-calendar-time-wrap .minute-t",function(){n.creatTimeNumTable(1)});n.$timeMode.off("click.x").on("click.x",".zr-calendar-time-wrap .sec-t",function(){n.creatTimeNumTable(2)});n.$timeMode.off("click.y").on("click.y",".zr-calendar-time-num .time-num-houer td",function(){n.nowTime.h=c(this).text();
n.creatTimeTable();k()});n.$timeMode.off("click.z").on("click.z",".zr-calendar-time-num .time-num-minute td",function(){n.nowTime.m=c(this).text();n.creatTimeTable();k()});n.$timeMode.off("click.aa").on("click.aa",".zr-calendar-time-num .time-num-sec td",function(){n.nowTime.s=c(this).text();n.creatTimeTable();k()})}function i(){if(j===3){if(n.nowTime.year!=h.y){n.$timeMode.find(".c-year-info .t-y").text(n.nowTime.year);h.y=n.nowTime.year}if(n.nowTime.month!=h.m){n.$timeMode.find(".c-year-info .t-m").text(n.nowTime.month-0+1);h.m=n.nowTime.month}if(n.nowTime.day!=h.d){n.$timeMode.find(".c-day-info .t-d").text(n.nowTime.day);h.d=n.nowTime.day}}}n.getTodayTime();switch(j){case 1:n.creatDayTable();l(n.nowTime.year);g();m();break;case 2:n.creatMonthTable();l(n.nowTime.year);g();break;case 3:n.creatDayTable();n.creatTimeTable();l(n.nowTime.year);g();m();k();break;default:n.$timeMode.addClass("only-time-wrap");n.creatTimeTable();k()}n.$wrap.show();n.h=n.$wrap.outerHeight()};f.prototype.seat=function(m){var i=c(m),o=this,q=o.opts.w,k=o.opts.h,r=0,n=0,j=0,u=0,g=0,p=0,s=0;r=o.w;n=o.h;q=i.outerWidth();k=i.outerHeight();j=i.offset().left-c(a).scrollLeft();u=i.offset().top-c(a).scrollTop();g=c(b).width()-j;p=c(b).height()-u-o.opts.h;s=g-j;if(j!=o.opts.leftW){o.$wrap.css({left:j});o.opts.leftW=j}if(u!=o.opts.topW){if(p<n){o.$wrap.css({top:"auto",bottom:u})}else{o.$wrap.css({bottom:"auto",top:u+k})}o.opts.topW=u}if(p<n){o.$wrap.css({top:"auto",bottom:p+k})}else{o.$wrap.css({bottom:"auto",top:u+k})}if(s<205){o.$timeMode.css({left:"auto",right:"100%"})}};f.prototype.getCalenTime=function(h){var j=this,i=null;function g(k){return k=parseInt(k)>9?parseInt(k):"0"+parseInt(k)}j.nowTime.year=g(j.nowTime.year);j.nowTime.day=g(j.nowTime.day);j.nowTime.h=g(j.nowTime.h);j.nowTime.m=g(j.nowTime.m);j.nowTime.s=g(j.nowTime.s);switch(h){case 1:i=j.nowTime.year+"/"+(g(j.nowTime.month+1))+"/"+j.nowTime.day;break;case 2:i=j.nowTime.year+"/"+(g(j.nowTime.month+1));break;case 3:i=j.nowTime.year+"/"+(g(j.nowTime.month+1))+"/"+j.nowTime.day+" "+j.nowTime.h+":"+j.nowTime.m+":"+j.nowTime.s;break;default:i=j.nowTime.h+":"+j.nowTime.m+":"+j.nowTime.s}return i};f.prototype.confirmBtnHandle=function(g,h){var j=this,i=null;j.$footer.on("click",".confirm-btn",function(){i=j.getCalenTime(g);h&&h(i);j.$wrap.hide();j.initTime=JSON.parse(JSON.stringify(j.nowTime))})};f.prototype.todayBtnHandle=function(g,h){var j=this,i=null;j.$footer.on("click",".today-btn",function(){j.nowTime=JSON.parse(JSON.stringify(j.todayTime));i=j.getCalenTime(g);h&&h(i);j.$wrap.hide()})};f.prototype.cancelBtnHandle=function(g,h){var j=this,i=null;j.$footer.on("click",".cancel-btn",function(){j.nowTime=JSON.parse(JSON.stringify(j.initTime));i=j.getCalenTime(g);h&&h(i);j.$wrap.hide()})};return this.each(function(){var j=c(this),i={},g=null,h=false;i.defaultTime=e.defaultTime;i.leftW=j.offset().left-c(a).scrollLeft();i.topW=j.offset().top-c(a).scrollTop();i.w=j.outerWidth();i.h=j.outerHeight();i.calenW=e.calenWidth?parseFloat(e.calenWidth):j.outerWidth();i.calenH=e.calenHeight?parseFloat(e.calenHeight):"auto";e.beforeCreatFn&&(walk=e.beforeCreatFn());walk=(walk===undefined)?true:walk;if(walk){g=new f(i);e.skin&&g.$wrap.append(e.skin);e.afterCreatFn&&e.afterCreatFn(g.$wrap);j.on("click",function(){if(h){g.$wrap.hide();h=false}else{g.toInit(e.type);g.seat(j);h=true}});g.confirmBtnHandle(e.type,function(k){e.changeTimeFn&&e.changeTimeFn(k);h=false});g.todayBtnHandle(e.type,function(k){e.changeTimeFn&&e.changeTimeFn(k);h=false});g.cancelBtnHandle(e.type,function(k){h=false});c(b).on("resize",function(){if(h){g.seat(j)}});c(b).on("scroll",function(){if(h){g.seat(j)}})}else{return false}})}}(jQuery,window,document));